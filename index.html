<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åˆæˆå™¨ Synth</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 20px;
  }

  h1 {
    margin-bottom: 10px;
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 30px;
    justify-content: center;
  }

  .control {
    background: #222;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 10px #000 inset;
  }

  label {
    display: block;
    margin-bottom: 5px;
  }

  input[type="range"] {
    width: 150px;
  }

  .keyboard {
    display: flex;
    justify-content: center;
    margin-top: 10px;
  }

  .key {
    width: 50px;
    height: 150px;
    margin: 1px;
    background: white;
    border: 1px solid #333;
    border-radius: 4px;
    text-align: center;
    line-height: 150px;
    cursor: pointer;
    color: black;
    font-weight: bold;
    user-select: none;
  }

  .key.active {
    background: #ffb100;
  }
</style>
</head>
<body>

<h1>ğŸ¹ ç€è¦½å™¨åˆæˆå™¨</h1>

<div class="controls">
  <div class="control">
    <label>æ³¢å½¢ (Waveform)</label>
    <select id="waveform">
      <option value="sine">Sine</option>
      <option value="square">Square</option>
      <option value="triangle">Triangle</option>
      <option value="sawtooth">Sawtooth</option>
    </select>
  </div>

  <div class="control">
    <label>éŸ³é‡ (Volume)</label>
    <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5">
  </div>

  <div class="control">
    <label>æ¿¾æ³¢ (Low-pass filter)</label>
    <input type="range" id="filter" min="100" max="10000" step="100" value="5000">
  </div>
</div>

<div class="keyboard">
  <div class="key" data-freq="261.63">C</div>
  <div class="key" data-freq="293.66">D</div>
  <div class="key" data-freq="329.63">E</div>
  <div class="key" data-freq="349.23">F</div>
  <div class="key" data-freq="392.00">G</div>
  <div class="key" data-freq="440.00">A</div>
  <div class="key" data-freq="493.88">B</div>
  <div class="key" data-freq="523.25">C</div>
</div>

<script>
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  let currentOsc = null;
  let gainNode = audioCtx.createGain();
  let filterNode = audioCtx.createBiquadFilter();
  gainNode.connect(filterNode);
  filterNode.connect(audioCtx.destination);

  const waveformSelect = document.getElementById('waveform');
  const volumeSlider = document.getElementById('volume');
  const filterSlider = document.getElementById('filter');

  volumeSlider.addEventListener('input', () => {
    gainNode.gain.value = volumeSlider.value;
  });

  filterSlider.addEventListener('input', () => {
    filterNode.frequency.value = filterSlider.value;
  });

  document.querySelectorAll('.key').forEach(key => {
    key.addEventListener('mousedown', () => playKey(key));
    key.addEventListener('mouseup', stopKey);
    key.addEventListener('mouseleave', stopKey);
  });

  function playKey(key) {
    const freq = parseFloat(key.dataset.freq);
    if (currentOsc) stopKey();
    currentOsc = audioCtx.createOscillator();
    currentOsc.type = waveformSelect.value;
    currentOsc.frequency.value = freq;
    currentOsc.connect(gainNode);
    currentOsc.start();
    key.classList.add('active');
  }

  function stopKey() {
    if (currentOsc) {
      currentOsc.stop();
      currentOsc.disconnect();
      currentOsc = null;
    }
    document.querySelectorAll('.key').forEach(k => k.classList.remove('active'));
  }

  // åˆå§‹å€¼
  gainNode.gain.value = volumeSlider.value;
  filterNode.type = 'lowpass';
  filterNode.frequency.value = filterSlider.value;
</script>

</body>
</html>
